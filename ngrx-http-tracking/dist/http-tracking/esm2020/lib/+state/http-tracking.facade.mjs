import * as HttpTrackingActions from './http-tracking.actions';
import * as HttpTrackingSelectors from './http-tracking.selectors';
import { debounceTime, filter, map, take } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { forkJoin } from 'rxjs';
import { isError } from '../function/is-error';
import { mapActionTypeToId } from '../function/map-action-typ-to-id';
import { LoadingState } from '../model/loading-state';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/store";
export class HttpTrackingFacade {
    constructor(store) {
        this.store = store;
    }
    getTracking(action) {
        return this.store.select(HttpTrackingSelectors.selectOneHttpTracking(mapActionTypeToId(action.type)));
    }
    isLoading(action) {
        return this.getTracking(action).pipe(map((x) => x?.httpStatus === LoadingState.LOADING));
    }
    isLoaded(action) {
        return this.getTracking(action).pipe(map((x) => x?.httpStatus === LoadingState.LOADED));
    }
    isInit(action) {
        return this.getTracking(action).pipe(map((x) => !x || x.httpStatus === LoadingState.INIT));
    }
    getError(action) {
        return this.getTracking(action).pipe(filter((x) => isError(x?.httpStatus)), map((x) => (x?.httpStatus).message));
    }
    isTagLoading(tag) {
        return this.store
            .select(HttpTrackingSelectors.selectLoadingByTag(tag))
            .pipe(debounceTime(100));
    }
    getTagErrors(tag) {
        return this.store
            .select(HttpTrackingSelectors.selectErrorsByTag(tag))
            .pipe(debounceTime(100));
    }
    clearGloballyHandledErrors() {
        this.store.dispatch(HttpTrackingActions.clearGloballyHandledErrors());
    }
    clearTrackingMulti(actions) {
        actions.forEach((action) => {
            this.store.dispatch(HttpTrackingActions.trackHttpRequest({
                action: mapActionTypeToId(action.type),
                httpStatus: LoadingState.INIT,
                tags: action['tags'],
            }));
        });
    }
    getGlobalLoading() {
        return this.store
            .select(HttpTrackingSelectors.selectLoadingByTag('global'))
            .pipe(debounceTime(300));
    }
    getGlobalErrors() {
        return this.store
            .select(HttpTrackingSelectors.selectErrorsByTag('global'))
            .pipe(debounceTime(300));
    }
    getResolved(action) {
        return this.getTracking(action.loading).pipe(filter((tracking) => !!tracking), map((tracking) => tracking.httpStatus), filter((httpStatus) => httpStatus === LoadingState.LOADED || isError(httpStatus)), take(1), map((httpStatus) => {
            const retVal = {
                action,
                success: httpStatus === LoadingState.LOADED,
            };
            if (isError(httpStatus)) {
                retVal.error = httpStatus;
            }
            return retVal;
        }));
    }
    getMultiResolved(actions) {
        const results = actions.map((a) => this.getResolved(a));
        return forkJoin(results);
    }
}
HttpTrackingFacade.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.3", ngImport: i0, type: HttpTrackingFacade, deps: [{ token: i1.Store }], target: i0.ɵɵFactoryTarget.Injectable });
HttpTrackingFacade.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.1.3", ngImport: i0, type: HttpTrackingFacade });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.3", ngImport: i0, type: HttpTrackingFacade, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Store }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC10cmFja2luZy5mYWNhZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9odHRwLXRyYWNraW5nL3NyYy9saWIvK3N0YXRlL2h0dHAtdHJhY2tpbmcuZmFjYWRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxtQkFBbUIsTUFBTSx5QkFBeUIsQ0FBQztBQUMvRCxPQUFPLEtBQUsscUJBQXFCLE1BQU0sMkJBQTJCLENBQUM7QUFHbkUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFFBQVEsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFckUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDOzs7QUFTdEQsTUFBTSxPQUFPLGtCQUFrQjtJQUM3QixZQUFvQixLQUFZO1FBQVosVUFBSyxHQUFMLEtBQUssQ0FBTztJQUFHLENBQUM7SUFFN0IsV0FBVyxDQUNoQixNQUFjO1FBRWQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FDdEIscUJBQXFCLENBQUMscUJBQXFCLENBQ3pDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FDL0IsQ0FDRixDQUFDO0lBQ0osQ0FBQztJQUVNLFNBQVMsQ0FBSSxNQUFjO1FBQ2hDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQ2xDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLFVBQVUsS0FBSyxZQUFZ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QUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFzQixRQUFTLENBQUMsVUFBVSxDQUFDLEVBQzVELE1BQU0sQ0FDSixDQUFDLFVBQVUsRUFBRSxFQUFFLENBQ2IsVUFBVSxLQUFLLFlBQVksQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUM1RCxFQUNELElBQUksQ0FBQyxDQUFDLENBQUMsRUFDUCxHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUNqQixNQUFNLE1BQU0sR0FBK0I7Z0JBQ3pDLE1BQU07Z0JBQ04sT0FBTyxFQUFFLFVBQVUsS0FBSyxZQUFZLENBQUMsTUFBTTthQUM1QyxDQUFDO1lBQ0YsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7Z0JBQ3ZCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDO2FBQzNCO1lBQ0QsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFFTSxnQkFBZ0IsQ0FDckIsT0FBaUM7UUFFakMsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hELE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNCLENBQUM7OytHQTNHVSxrQkFBa0I7bUhBQWxCLGtCQUFrQjsyRkFBbEIsa0JBQWtCO2tCQUQ5QixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgSHR0cFRyYWNraW5nQWN0aW9ucyBmcm9tICcuL2h0dHAtdHJhY2tpbmcuYWN0aW9ucyc7XHJcbmltcG9ydCAqIGFzIEh0dHBUcmFja2luZ1NlbGVjdG9ycyBmcm9tICcuL2h0dHAtdHJhY2tpbmcuc2VsZWN0b3JzJztcclxuaW1wb3J0IHsgQWN0aW9uLCBTdG9yZSB9IGZyb20gJ0BuZ3J4L3N0b3JlJztcclxuaW1wb3J0IHsgSHR0cFRyYWNraW5nRW50aXR5IH0gZnJvbSAnLi4vbW9kZWwvaHR0cC10cmFja2luZy1lbnRpdHknO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGZpbHRlciwgbWFwLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGZvcmtKb2luLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGlzRXJyb3IgfSBmcm9tICcuLi9mdW5jdGlvbi9pcy1lcnJvcic7XHJcbmltcG9ydCB7IG1hcEFjdGlvblR5cGVUb0lkIH0gZnJvbSAnLi4vZnVuY3Rpb24vbWFwLWFjdGlvbi10eXAtdG8taWQnO1xyXG5pbXBvcnQgeyBUcmFja2luZ0FjdGlvbiB9IGZyb20gJy4uL2Z1bmN0aW9uL2h0dHAtdHJhY2tpbmctYWN0aW9ucy5mYWN0b3J5JztcclxuaW1wb3J0IHsgTG9hZGluZ1N0YXRlIH0gZnJvbSAnLi4vbW9kZWwvbG9hZGluZy1zdGF0ZSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEh0dHBUcmFja2luZ1Jlc3VsdDxUMSwgVDI+IHtcclxuICBhY3Rpb246IFRyYWNraW5nQWN0aW9uPFQxLCBUMj47XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBlcnJvcj86IEVycm9yO1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBIdHRwVHJhY2tpbmdGYWNhZGUge1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgc3RvcmU6IFN0b3JlKSB7fVxyXG5cclxuICBwdWJsaWMgZ2V0VHJhY2tpbmcoXHJcbiAgICBhY3Rpb246IEFjdGlvblxyXG4gICk6IE9ic2VydmFibGU8SHR0cFRyYWNraW5nRW50aXR5IHwgdW5kZWZpbmVkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zdG9yZS5zZWxlY3QoXHJcbiAgICAgIEh0dHBUcmFja2luZ1NlbGVjdG9ycy5zZWxlY3RPbmVIdHRwVHJhY2tpbmcoXHJcbiAgICAgICAgbWFwQWN0aW9uVHlwZVRvSWQoYWN0aW9uLnR5cGUpXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNMb2FkaW5nPFQ+KGFjdGlvbjogQWN0aW9uKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRUcmFja2luZyhhY3Rpb24pLnBpcGUoXHJcbiAgICAgIG1hcCgoeCkgPT4geD8uaHR0cFN0YXR1cyA9PT0gTG9hZGluZ1N0YXRlLkxPQURJTkcpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzTG9hZGVkPFQ+KGFjdGlvbjogQWN0aW9uKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRUcmFja2luZyhhY3Rpb24pLnBpcGUoXHJcbiAgICAgIG1hcCgoeCkgPT4geD8uaHR0cFN0YXR1cyA9PT0gTG9hZGluZ1N0YXRlLkxPQURFRClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNJbml0PFQ+KGFjdGlvbjogQWN0aW9uKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRUcmFja2luZyhhY3Rpb24pLnBpcGUoXHJcbiAgICAgIG1hcCgoeCkgPT4gIXggfHwgeC5odHRwU3RhdHVzID09PSBMb2FkaW5nU3RhdGUuSU5JVClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0RXJyb3I8VD4oYWN0aW9uOiBBY3Rpb24pOiBPYnNlcnZhYmxlPHN0cmluZyB8IG51bGw+IHtcclxuICAgIHJldHVybiB0aGlzLmdldFRyYWNraW5nKGFjdGlvbikucGlwZShcclxuICAgICAgZmlsdGVyKCh4KSA9PiBpc0Vycm9yKHg/Lmh0dHBTdGF0dXMpKSxcclxuICAgICAgbWFwKCh4KSA9PiAoPEVycm9yPng/Lmh0dHBTdGF0dXMpLm1lc3NhZ2UpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzVGFnTG9hZGluZyh0YWc6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RvcmVcclxuICAgICAgLnNlbGVjdChIdHRwVHJhY2tpbmdTZWxlY3RvcnMuc2VsZWN0TG9hZGluZ0J5VGFnKHRhZykpXHJcbiAgICAgIC5waXBlKGRlYm91bmNlVGltZSgxMDApKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRUYWdFcnJvcnModGFnOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLnN0b3JlXHJcbiAgICAgIC5zZWxlY3QoSHR0cFRyYWNraW5nU2VsZWN0b3JzLnNlbGVjdEVycm9yc0J5VGFnKHRhZykpXHJcbiAgICAgIC5waXBlKGRlYm91bmNlVGltZSgxMDApKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbGVhckdsb2JhbGx5SGFuZGxlZEVycm9ycygpIHtcclxuICAgIHRoaXMuc3RvcmUuZGlzcGF0Y2goSHR0cFRyYWNraW5nQWN0aW9ucy5jbGVhckdsb2JhbGx5SGFuZGxlZEVycm9ycygpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbGVhclRyYWNraW5nTXVsdGkoYWN0aW9uczogQWN0aW9uW10pIHtcclxuICAgIGFjdGlvbnMuZm9yRWFjaCgoYWN0aW9uOiBhbnkpID0+IHtcclxuICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaChcclxuICAgICAgICBIdHRwVHJhY2tpbmdBY3Rpb25zLnRyYWNrSHR0cFJlcXVlc3Qoe1xyXG4gICAgICAgICAgYWN0aW9uOiBtYXBBY3Rpb25UeXBlVG9JZChhY3Rpb24udHlwZSksXHJcbiAgICAgICAgICBodHRwU3RhdHVzOiBMb2FkaW5nU3RhdGUuSU5JVCxcclxuICAgICAgICAgIHRhZ3M6IGFjdGlvblsndGFncyddLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRHbG9iYWxMb2FkaW5nKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RvcmVcclxuICAgICAgLnNlbGVjdChIdHRwVHJhY2tpbmdTZWxlY3RvcnMuc2VsZWN0TG9hZGluZ0J5VGFnKCdnbG9iYWwnKSlcclxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEdsb2JhbEVycm9ycygpIHtcclxuICAgIHJldHVybiB0aGlzLnN0b3JlXHJcbiAgICAgIC5zZWxlY3QoSHR0cFRyYWNraW5nU2VsZWN0b3JzLnNlbGVjdEVycm9yc0J5VGFnKCdnbG9iYWwnKSlcclxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDMwMCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFJlc29sdmVkPFQxLCBUMj4oXHJcbiAgICBhY3Rpb246IFRyYWNraW5nQWN0aW9uPFQxLCBUMj5cclxuICApOiBPYnNlcnZhYmxlPEh0dHBUcmFja2luZ1Jlc3VsdDxUMSwgVDI+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRUcmFja2luZyhhY3Rpb24ubG9hZGluZykucGlwZShcclxuICAgICAgZmlsdGVyKCh0cmFja2luZykgPT4gISF0cmFja2luZyksXHJcbiAgICAgIG1hcCgodHJhY2tpbmcpID0+ICg8SHR0cFRyYWNraW5nRW50aXR5PnRyYWNraW5nKS5odHRwU3RhdHVzKSxcclxuICAgICAgZmlsdGVyKFxyXG4gICAgICAgIChodHRwU3RhdHVzKSA9PlxyXG4gICAgICAgICAgaHR0cFN0YXR1cyA9PT0gTG9hZGluZ1N0YXRlLkxPQURFRCB8fCBpc0Vycm9yKGh0dHBTdGF0dXMpXHJcbiAgICAgICksXHJcbiAgICAgIHRha2UoMSksXHJcbiAgICAgIG1hcCgoaHR0cFN0YXR1cykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJldFZhbCA9IDxIdHRwVHJhY2tpbmdSZXN1bHQ8VDEsIFQyPj57XHJcbiAgICAgICAgICBhY3Rpb24sXHJcbiAgICAgICAgICBzdWNjZXNzOiBodHRwU3RhdHVzID09PSBMb2FkaW5nU3RhdGUuTE9BREVELFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGlzRXJyb3IoaHR0cFN0YXR1cykpIHtcclxuICAgICAgICAgIHJldFZhbC5lcnJvciA9IGh0dHBTdGF0dXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldE11bHRpUmVzb2x2ZWQ8VDEsIFQyPihcclxuICAgIGFjdGlvbnM6IFRyYWNraW5nQWN0aW9uPFQxLCBUMj5bXVxyXG4gICk6IE9ic2VydmFibGU8SHR0cFRyYWNraW5nUmVzdWx0PFQxLCBUMj5bXT4ge1xyXG4gICAgY29uc3QgcmVzdWx0cyA9IGFjdGlvbnMubWFwKChhKSA9PiB0aGlzLmdldFJlc29sdmVkKGEpKTtcclxuICAgIHJldHVybiBmb3JrSm9pbihyZXN1bHRzKTtcclxuICB9XHJcbn1cclxuIl19