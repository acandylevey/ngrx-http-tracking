import * as HttpTrackingActions from './http-tracking.actions';
import * as HttpTrackingSelectors from './http-tracking.selectors';
import { debounceTime, filter, map, take } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { forkJoin } from 'rxjs';
import { isError } from '../function/is-error';
import { mapActionTypeToId } from '../function/map-action-typ-to-id';
import { LoadingState } from '../model/loading-state';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/store";
export class HttpTrackingFacade {
    constructor(store) {
        this.store = store;
    }
    getTracking(action) {
        return this.store.select(HttpTrackingSelectors.selectOneHttpTracking(mapActionTypeToId(action.type)));
    }
    isLoading(action) {
        return this.getTracking(action).pipe(map((x) => x?.httpStatus === LoadingState.LOADING));
    }
    isLoaded(action) {
        return this.getTracking(action).pipe(map((x) => x?.httpStatus === LoadingState.LOADED));
    }
    isInit(action) {
        return this.getTracking(action).pipe(map((x) => !x || x.httpStatus === LoadingState.INIT));
    }
    getError(action) {
        return this.getTracking(action).pipe(filter((x) => isError(x?.httpStatus)), map((x) => (x?.httpStatus).message));
    }
    isTagLoading(tag) {
        return this.store
            .select(HttpTrackingSelectors.selectLoadingByTag(tag))
            .pipe(debounceTime(100));
    }
    getTagErrors(tag) {
        return this.store
            .select(HttpTrackingSelectors.selectErrorsByTag(tag))
            .pipe(debounceTime(100));
    }
    clearGloballyHandledErrors() {
        this.store.dispatch(HttpTrackingActions.clearGloballyHandledErrors());
    }
    clearTrackingMulti(actions) {
        actions.forEach((action) => {
            this.store.dispatch(HttpTrackingActions.trackHttpRequest({
                action: mapActionTypeToId(action.type),
                httpStatus: LoadingState.INIT,
                tags: action['tags'],
            }));
        });
    }
    getGlobalLoading() {
        return this.store
            .select(HttpTrackingSelectors.selectLoadingByTag('global'))
            .pipe(debounceTime(300));
    }
    getGlobalErrors() {
        return this.store
            .select(HttpTrackingSelectors.selectErrorsByTag('global'))
            .pipe(debounceTime(300));
    }
    getResolved(action) {
        return this.getTracking(action.loading).pipe(filter((tracking) => !!tracking), map((tracking) => tracking.httpStatus), filter((httpStatus) => httpStatus === LoadingState.LOADED || isError(httpStatus)), take(1), map((httpStatus) => {
            const retVal = {
                action,
                success: httpStatus === LoadingState.LOADED,
            };
            if (isError(httpStatus)) {
                retVal.error = httpStatus;
            }
            return retVal;
        }));
    }
    getMultiResolved(actions) {
        const results = actions.map((a) => this.getResolved(a));
        return forkJoin(results);
    }
}
HttpTrackingFacade.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.3", ngImport: i0, type: HttpTrackingFacade, deps: [{ token: i1.Store }], target: i0.ɵɵFactoryTarget.Injectable });
HttpTrackingFacade.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.1.3", ngImport: i0, type: HttpTrackingFacade });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.3", ngImport: i0, type: HttpTrackingFacade, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Store }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC10cmFja2luZy5mYWNhZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3J4LWh0dHAtdHJhY2tpbmcvc3JjL2xpYi8rc3RhdGUvaHR0cC10cmFja2luZy5mYWNhZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLG1CQUFtQixNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sS0FBSyxxQkFBcUIsTUFBTSwyQkFBMkIsQ0FBQztBQUduRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsUUFBUSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUVyRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7OztBQVN0RCxNQUFNLE9BQU8sa0JBQWtCO0lBQzdCLFlBQW9CLEtBQVk7UUFBWixVQUFLLEdBQUwsS0FBSyxDQUFPO0lBQUcsQ0FBQztJQUU3QixXQUFXLENBQ2hCLE1BQWM7UUFFZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUN0QixxQkFBcUIsQ0FBQyxxQkFBcUIsQ0FDekMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUMvQixDQUNGLENBQUM7SUFDSixDQUFDO0lBRU0sU0FBUyxDQUFJLE1BQWM7UUFDaEMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDbEMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsVUFBVSxLQUFL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Q2hDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQXNCLFFBQVMsQ0FBQyxVQUFVLENBQUMsRUFDNUQsTUFBTSxDQUNKLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FDYixVQUFVLEtBQUssWUFBWSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQzVELEVBQ0QsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLEdBQUcsQ0FBQyxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sTUFBTSxHQUErQjtnQkFDekMsTUFBTTtnQkFDTixPQUFPLEVBQUUsVUFBVSxLQUFLLFlBQVksQ0FBQyxNQUFNO2FBQzVDLENBQUM7WUFDRixJQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDdkIsTUFBTSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUM7YUFDM0I7WUFDRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVNLGdCQUFnQixDQUNyQixPQUFpQztRQUVqQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEQsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0IsQ0FBQzs7K0dBM0dVLGtCQUFrQjttSEFBbEIsa0JBQWtCOzJGQUFsQixrQkFBa0I7a0JBRDlCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBIdHRwVHJhY2tpbmdBY3Rpb25zIGZyb20gJy4vaHR0cC10cmFja2luZy5hY3Rpb25zJztcclxuaW1wb3J0ICogYXMgSHR0cFRyYWNraW5nU2VsZWN0b3JzIGZyb20gJy4vaHR0cC10cmFja2luZy5zZWxlY3RvcnMnO1xyXG5pbXBvcnQgeyBBY3Rpb24sIFN0b3JlIH0gZnJvbSAnQG5ncngvc3RvcmUnO1xyXG5pbXBvcnQgeyBIdHRwVHJhY2tpbmdFbnRpdHkgfSBmcm9tICcuLi9tb2RlbC9odHRwLXRyYWNraW5nLWVudGl0eSc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZmlsdGVyLCBtYXAsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgZm9ya0pvaW4sIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgaXNFcnJvciB9IGZyb20gJy4uL2Z1bmN0aW9uL2lzLWVycm9yJztcclxuaW1wb3J0IHsgbWFwQWN0aW9uVHlwZVRvSWQgfSBmcm9tICcuLi9mdW5jdGlvbi9tYXAtYWN0aW9uLXR5cC10by1pZCc7XHJcbmltcG9ydCB7IFRyYWNraW5nQWN0aW9uIH0gZnJvbSAnLi4vZnVuY3Rpb24vaHR0cC10cmFja2luZy1hY3Rpb25zLmZhY3RvcnknO1xyXG5pbXBvcnQgeyBMb2FkaW5nU3RhdGUgfSBmcm9tICcuLi9tb2RlbC9sb2FkaW5nLXN0YXRlJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSHR0cFRyYWNraW5nUmVzdWx0PFQxLCBUMj4ge1xyXG4gIGFjdGlvbjogVHJhY2tpbmdBY3Rpb248VDEsIFQyPjtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yPzogRXJyb3I7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEh0dHBUcmFja2luZ0ZhY2FkZSB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzdG9yZTogU3RvcmUpIHt9XHJcblxyXG4gIHB1YmxpYyBnZXRUcmFja2luZyhcclxuICAgIGFjdGlvbjogQWN0aW9uXHJcbiAgKTogT2JzZXJ2YWJsZTxIdHRwVHJhY2tpbmdFbnRpdHkgfCB1bmRlZmluZWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnN0b3JlLnNlbGVjdChcclxuICAgICAgSHR0cFRyYWNraW5nU2VsZWN0b3JzLnNlbGVjdE9uZUh0dHBUcmFja2luZyhcclxuICAgICAgICBtYXBBY3Rpb25UeXBlVG9JZChhY3Rpb24udHlwZSlcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0xvYWRpbmc8VD4oYWN0aW9uOiBBY3Rpb24pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLmdldFRyYWNraW5nKGFjdGlvbikucGlwZShcclxuICAgICAgbWFwKCh4KSA9PiB4Py5odHRwU3RhdHVzID09PSBMb2FkaW5nU3RhdGUuTE9BRElORylcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNMb2FkZWQ8VD4oYWN0aW9uOiBBY3Rpb24pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLmdldFRyYWNraW5nKGFjdGlvbikucGlwZShcclxuICAgICAgbWFwKCh4KSA9PiB4Py5odHRwU3RhdHVzID09PSBMb2FkaW5nU3RhdGUuTE9BREVEKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0luaXQ8VD4oYWN0aW9uOiBBY3Rpb24pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLmdldFRyYWNraW5nKGFjdGlvbikucGlwZShcclxuICAgICAgbWFwKCh4KSA9PiAheCB8fCB4Lmh0dHBTdGF0dXMgPT09IExvYWRpbmdTdGF0ZS5JTklUKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRFcnJvcjxUPihhY3Rpb246IEFjdGlvbik6IE9ic2VydmFibGU8c3RyaW5nIHwgbnVsbD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0VHJhY2tpbmcoYWN0aW9uKS5waXBlKFxyXG4gICAgICBmaWx0ZXIoKHgpID0+IGlzRXJyb3IoeD8uaHR0cFN0YXR1cykpLFxyXG4gICAgICBtYXAoKHgpID0+ICg8RXJyb3I+eD8uaHR0cFN0YXR1cykubWVzc2FnZSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNUYWdMb2FkaW5nKHRhZzogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdG9yZVxyXG4gICAgICAuc2VsZWN0KEh0dHBUcmFja2luZ1NlbGVjdG9ycy5zZWxlY3RMb2FkaW5nQnlUYWcodGFnKSlcclxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDEwMCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFRhZ0Vycm9ycyh0YWc6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RvcmVcclxuICAgICAgLnNlbGVjdChIdHRwVHJhY2tpbmdTZWxlY3RvcnMuc2VsZWN0RXJyb3JzQnlUYWcodGFnKSlcclxuICAgICAgLnBpcGUoZGVib3VuY2VUaW1lKDEwMCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsZWFyR2xvYmFsbHlIYW5kbGVkRXJyb3JzKCkge1xyXG4gICAgdGhpcy5zdG9yZS5kaXNwYXRjaChIdHRwVHJhY2tpbmdBY3Rpb25zLmNsZWFyR2xvYmFsbHlIYW5kbGVkRXJyb3JzKCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsZWFyVHJhY2tpbmdNdWx0aShhY3Rpb25zOiBBY3Rpb25bXSkge1xyXG4gICAgYWN0aW9ucy5mb3JFYWNoKChhY3Rpb246IGFueSkgPT4ge1xyXG4gICAgICB0aGlzLnN0b3JlLmRpc3BhdGNoKFxyXG4gICAgICAgIEh0dHBUcmFja2luZ0FjdGlvbnMudHJhY2tIdHRwUmVxdWVzdCh7XHJcbiAgICAgICAgICBhY3Rpb246IG1hcEFjdGlvblR5cGVUb0lkKGFjdGlvbi50eXBlKSxcclxuICAgICAgICAgIGh0dHBTdGF0dXM6IExvYWRpbmdTdGF0ZS5JTklULFxyXG4gICAgICAgICAgdGFnczogYWN0aW9uWyd0YWdzJ10sXHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEdsb2JhbExvYWRpbmcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdG9yZVxyXG4gICAgICAuc2VsZWN0KEh0dHBUcmFja2luZ1NlbGVjdG9ycy5zZWxlY3RMb2FkaW5nQnlUYWcoJ2dsb2JhbCcpKVxyXG4gICAgICAucGlwZShkZWJvdW5jZVRpbWUoMzAwKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0R2xvYmFsRXJyb3JzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc3RvcmVcclxuICAgICAgLnNlbGVjdChIdHRwVHJhY2tpbmdTZWxlY3RvcnMuc2VsZWN0RXJyb3JzQnlUYWcoJ2dsb2JhbCcpKVxyXG4gICAgICAucGlwZShkZWJvdW5jZVRpbWUoMzAwKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0UmVzb2x2ZWQ8VDEsIFQyPihcclxuICAgIGFjdGlvbjogVHJhY2tpbmdBY3Rpb248VDEsIFQyPlxyXG4gICk6IE9ic2VydmFibGU8SHR0cFRyYWNraW5nUmVzdWx0PFQxLCBUMj4+IHtcclxuICAgIHJldHVybiB0aGlzLmdldFRyYWNraW5nKGFjdGlvbi5sb2FkaW5nKS5waXBlKFxyXG4gICAgICBmaWx0ZXIoKHRyYWNraW5nKSA9PiAhIXRyYWNraW5nKSxcclxuICAgICAgbWFwKCh0cmFja2luZykgPT4gKDxIdHRwVHJhY2tpbmdFbnRpdHk+dHJhY2tpbmcpLmh0dHBTdGF0dXMpLFxyXG4gICAgICBmaWx0ZXIoXHJcbiAgICAgICAgKGh0dHBTdGF0dXMpID0+XHJcbiAgICAgICAgICBodHRwU3RhdHVzID09PSBMb2FkaW5nU3RhdGUuTE9BREVEIHx8IGlzRXJyb3IoaHR0cFN0YXR1cylcclxuICAgICAgKSxcclxuICAgICAgdGFrZSgxKSxcclxuICAgICAgbWFwKChodHRwU3RhdHVzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmV0VmFsID0gPEh0dHBUcmFja2luZ1Jlc3VsdDxUMSwgVDI+PntcclxuICAgICAgICAgIGFjdGlvbixcclxuICAgICAgICAgIHN1Y2Nlc3M6IGh0dHBTdGF0dXMgPT09IExvYWRpbmdTdGF0ZS5MT0FERUQsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoaXNFcnJvcihodHRwU3RhdHVzKSkge1xyXG4gICAgICAgICAgcmV0VmFsLmVycm9yID0gaHR0cFN0YXR1cztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0TXVsdGlSZXNvbHZlZDxUMSwgVDI+KFxyXG4gICAgYWN0aW9uczogVHJhY2tpbmdBY3Rpb248VDEsIFQyPltdXHJcbiAgKTogT2JzZXJ2YWJsZTxIdHRwVHJhY2tpbmdSZXN1bHQ8VDEsIFQyPltdPiB7XHJcbiAgICBjb25zdCByZXN1bHRzID0gYWN0aW9ucy5tYXAoKGEpID0+IHRoaXMuZ2V0UmVzb2x2ZWQoYSkpO1xyXG4gICAgcmV0dXJuIGZvcmtKb2luKHJlc3VsdHMpO1xyXG4gIH1cclxufVxyXG4iXX0=